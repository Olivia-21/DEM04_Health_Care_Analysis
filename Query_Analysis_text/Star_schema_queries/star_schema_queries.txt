QUESTION 1: Monthly Encounters by Specialty
SQL QUERY:

EXPLAIN ANALYZE
SELECT 
    f.encounter_year,
    f.encounter_month,
    f.encounter_month_name,
    f.specialty_name,
    f.encounter_type_name,
    COUNT(f.encounter_key) AS total_encounters,
    COUNT(DISTINCT f.patient_key) AS unique_patients
FROM fact_encounters f
GROUP BY 
    f.encounter_year,
    f.encounter_month,
    f.encounter_month_name,
    f.specialty_name,
    f.encounter_type_name
ORDER BY f.encounter_year, f.encounter_month, f.specialty_name, f.encounter_type_name;

SCHEMA ANALYSIS:
Tables joined: fact_encounters only (no JOINs needed)
Number of joins: 0

Execution Time Estimate: 41.86ms vs 81.6ms (OLTP)
Improvement factor: 1.95x faster

Explanation:
The optimized star schema query requires ZERO JOINs because all needed attributes (specialty_name, encounter_type_name, year, month, month_name) are denormalized directly into the fact table. The OLTP requires 2 JOINs (providers → specialties). This eliminates all table lookups and reduces query complexity significantly.




QUESTION 2: Diagnosis-Procedure Pairs
SQL QUERY:

EXPLAIN ANALYZE
SELECT 
    d.icd10_code,
    d.icd10_description,
    pr.cpt_code,
    pr.cpt_description,
    COUNT(DISTINCT bd.encounter_key) AS encounter_count
FROM bridge_encounter_diagnoses bd
JOIN dim_diagnosis d ON bd.diagnosis_key = d.diagnosis_key
JOIN bridge_encounter_procedures bp ON bd.encounter_key = bp.encounter_key
JOIN dim_procedure pr ON bp.procedure_key = pr.procedure_key
GROUP BY 
    d.icd10_code,
    d.icd10_description,
    pr.cpt_code,
    pr.cpt_description
ORDER BY encounter_count DESC
LIMIT 20;

SCHEMA ANALYSIS:
Tables joined: bridge_encounter_diagnoses, dim_diagnosis, bridge_encounter_procedures, dim_procedure
Number of joins: 3

Execution Time Estimate: 250ms vs 268.30ms (OLTP)
Improvement factor: 1.07x faster

Explanation:
This query still requires JOINs because diagnoses and procedures have a many-to-many relationship with encounters (bridge tables are necessary to avoid row explosion). However, the star schema uses pre-keyed surrogate keys in bridge tables, making lookups faster than the OLTP's encounter_diagnoses → diagnoses → encounter_procedures → procedures chain.




QUESTION 3: 30-Day Readmission Rate
SQL QUERY:

EXPLAIN ANALYZE
SELECT 
    f.specialty_name,
    COUNT(f.encounter_key) AS total_inpatient_discharges,
    SUM(f.is_readmission) AS readmission_count,
    ROUND(SUM(f.is_readmission) * 100.0 / COUNT(f.encounter_key), 2) AS readmission_rate_pct
FROM fact_encounters f
WHERE f.is_inpatient = TRUE
  AND f.discharge_date IS NOT NULL
GROUP BY f.specialty_name
ORDER BY readmission_rate_pct DESC;


SCHEMA ANALYSIS:
Tables joined: fact_encounters only (no JOINs needed)
Number of joins: 0

Execution Time Estimate: 15.0ms vs 29.83ms (OLTP)
Improvement factor: 2.0x faster

Explanation:
The optimized star schema query requires ZERO JOINs because:
1. specialty_name is denormalized into the fact table
2. is_readmission flag is pre-computed during ETL

The OLTP query requires 3 JOINs (self-join on encounters + providers + specialties) and expensive date comparisons. The star schema shifts all this computation to ETL time.




QUESTION 4: Revenue by Specialty and Month
SQL QUERY:

EXPLAIN ANALYZE
SELECT 
    f.encounter_year,
    f.encounter_month,
    f.encounter_month_name,
    f.specialty_name,
    COUNT(f.encounter_key) AS encounter_count,
    SUM(f.total_allowed_amount) AS total_revenue,
    AVG(f.total_allowed_amount) AS avg_revenue_per_encounter
FROM fact_encounters f
GROUP BY 
    f.encounter_year,
    f.encounter_month,
    f.encounter_month_name,
    f.specialty_name
ORDER BY f.encounter_year, f.encounter_month, total_revenue DESC;


SCHEMA ANALYSIS:
Tables joined: fact_encounters only (no JOINs needed)
Number of joins: 0

Execution Time Estimate: 31ms vs 52.47ms(OLTP)
Improvement factor: 1.7x faster

Explanation:
The optimized star schema query requires ZERO JOINs because specialty_name, year, month, and month_name are denormalized into the fact table. The OLTP requires 3 JOINs (billing → encounters → providers → specialties) plus DATE_FORMAT calculations. Pre-aggregated total_allowed_amount eliminates the billing table join entirely.




SUMMARY: JOIN Comparison

| Query | OLTP JOINs | Star Schema JOINs | Improvement |
|-------|------------|-------------------|-------------|
| Q1    | 2          | 0                 | 1.95x faster |
| Q2    | 3          | 3                 | 1.07x faster |
| Q3    | 3          | 0                 | 2.0x faster |
| Q4    | 3          | 0                 | 1.7x faster |

Key Design Decision:
By denormalizing specialty_name, encounter_type_name, and date attributes directly into the fact table, we eliminate JOINs for the most common analytical queries (Q1, Q3, Q4). This follows the star schema best practice of trading storage redundancy for query performance.
